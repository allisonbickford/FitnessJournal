<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExerciseGroupCard.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.catscoffeeandkitchen.fitnessjournal.ui.workouts.details.exercise</a> &gt; <span class="el_source">ExerciseGroupCard.kt</span></div><h1>ExerciseGroupCard.kt</h1><pre class="source lang-java linenums">package com.catscoffeeandkitchen.fitnessjournal.ui.workouts.details.exercise

import android.text.format.DateUtils
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.MoreVert
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.text.SpanStyle
import androidx.compose.ui.text.buildAnnotatedString
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.withStyle
import androidx.compose.ui.unit.dp
import com.catscoffeeandkitchen.domain.models.Exercise
import com.catscoffeeandkitchen.domain.models.ExerciseGroup
import com.catscoffeeandkitchen.domain.models.ExerciseSetType
import com.catscoffeeandkitchen.fitnessjournal.ui.components.FitnessJournalButton
import com.catscoffeeandkitchen.fitnessjournal.ui.components.FitnessJournalCard
import com.catscoffeeandkitchen.fitnessjournal.ui.util.WeightUnit
import com.catscoffeeandkitchen.fitnessjournal.ui.util.toCleanString
import java.time.Duration
import java.time.OffsetDateTime

@Composable
fun ExerciseGroupCard(
    group: ExerciseGroup,
    editGroup: () -&gt; Unit,
<span class="nc bnc" id="L33" title="All 2 branches missed.">    modifier: Modifier = Modifier,</span>
<span class="nc" id="L34">    onExerciseSelected: (Exercise) -&gt; Unit = {},</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">) {</span>
<span class="nc" id="L36">    var showExtrasDropdown by remember { mutableStateOf(false) }</span>

<span class="nc bnc" id="L38" title="All 2 branches missed.">    FitnessJournalCard(</span>
<span class="nc" id="L39">        modifier = modifier.padding(horizontal = 8.dp)</span>
<span class="nc" id="L40">    ) {</span>
<span class="nc bnc" id="L41" title="All 4 branches missed.">        Row(</span>
<span class="nc" id="L42">            verticalAlignment = Alignment.CenterVertically</span>
        ) {
<span class="nc bnc" id="L44" title="All 8 branches missed.">            Text(group.name.ifEmpty { &quot;Select from group&quot; },</span>
<span class="nc" id="L45">                style = MaterialTheme.typography.headlineSmall)</span>

<span class="nc" id="L47">            Box(modifier = Modifier.weight(1f)) {</span>
<span class="nc bnc" id="L48" title="All 4 branches missed.">                IconButton(</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">                    onClick = { showExtrasDropdown = !showExtrasDropdown },</span>
<span class="nc" id="L50">                ) {</span>
<span class="nc bnc" id="L51" title="All 4 branches missed.">                    Icon(Icons.Default.MoreVert, &quot;more exercise options&quot;)</span>
<span class="nc" id="L52">                }</span>
<span class="nc" id="L53">            }</span>

<span class="nc" id="L55">            DropdownMenu(</span>
<span class="nc" id="L56">                expanded = showExtrasDropdown,</span>
<span class="nc" id="L57">                onDismissRequest = { showExtrasDropdown = false }</span>
<span class="nc" id="L58">            ) {</span>
<span class="nc bnc" id="L59" title="All 4 branches missed.">                DropdownMenuItem(</span>
<span class="nc bnc" id="L60" title="All 4 branches missed.">                    text = { Text(&quot;edit group&quot;) },</span>
<span class="nc" id="L61">                    onClick = {</span>
<span class="nc" id="L62">                        editGroup()</span>
<span class="nc" id="L63">                    })</span>
<span class="nc" id="L64">            }</span>
<span class="nc" id="L65">        }</span>

<span class="nc" id="L67">        Column(</span>
<span class="nc" id="L68">            modifier = Modifier.padding(start = 8.dp, end = 8.dp, bottom = 8.dp),</span>
<span class="nc" id="L69">            verticalArrangement = Arrangement.spacedBy(8.dp)</span>
        ) {
<span class="nc bnc" id="L71" title="All 4 branches missed.">            group.exercises.forEach { exercise -&gt;</span>
<span class="nc" id="L72">                GroupExerciseItem(exercise, onSelect = onExerciseSelected)</span>
<span class="nc" id="L73">            }</span>
<span class="nc" id="L74">        }</span>

<span class="nc" id="L76">    }</span>
<span class="nc" id="L77">}</span>

@Composable
fun GroupExerciseItem(
    exercise: Exercise,
    onSelect: (Exercise) -&gt; Unit
<span class="nc" id="L83">) {</span>
<span class="nc" id="L84">    Column(</span>
<span class="nc" id="L85">        modifier = Modifier</span>
<span class="nc" id="L86">            .fillMaxWidth()</span>
<span class="nc" id="L87">            .clip(MaterialTheme.shapes.small)</span>
<span class="nc" id="L88">            .background(MaterialTheme.colorScheme.primaryContainer)</span>
<span class="nc" id="L89">            .padding(8.dp)</span>
<span class="nc" id="L90">            .clickable { onSelect(exercise) }</span>
    ) {
<span class="nc bnc" id="L92" title="All 4 branches missed.">        Text(exercise.name, style = MaterialTheme.typography.titleMedium)</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (exercise.stats != null) {</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">            val completed = exercise.stats?.lastCompletedAt</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">            val completedAmount = exercise.stats?.amountCompleted</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">            val completedAmountThisWeek = exercise.stats?.amountCompletedThisWeek</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (completed != null) {</span>
<span class="nc" id="L99">                val formattedDate = when {</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">                    Duration.between(completed, OffsetDateTime.now()).toDays() &lt; 2 -&gt; DateUtils.getRelativeTimeSpanString(</span>
<span class="nc" id="L101">                        completed.toInstant().toEpochMilli(),</span>
<span class="nc" id="L102">                        OffsetDateTime.now().toInstant().toEpochMilli(),</span>
<span class="nc" id="L103">                        DateUtils.DAY_IN_MILLIS</span>
<span class="nc" id="L104">                    ).toString().lowercase()</span>
<span class="nc" id="L105">                    else -&gt; completed.dayOfWeek.name.lowercase()</span>
                }
<span class="nc" id="L107">                Text(</span>
<span class="nc" id="L108">                    &quot;last completed $formattedDate&quot;,</span>
<span class="nc" id="L109">                    style = MaterialTheme.typography.labelMedium</span>
                )
<span class="nc" id="L111">            } else {</span>
<span class="nc" id="L112">                Text(</span>
<span class="nc" id="L113">                    &quot;Never completed&quot;,</span>
<span class="nc" id="L114">                    style = MaterialTheme.typography.labelMedium</span>
                )
            }

<span class="nc bnc" id="L118" title="All 4 branches missed.">            if (completedAmountThisWeek != null &amp;&amp; completedAmountThisWeek &gt; 0) {</span>
<span class="nc" id="L119">                Text(&quot;$completedAmountThisWeek &quot; +</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">                        &quot;${if (completedAmountThisWeek == 1) &quot;set&quot; else &quot;sets&quot;} &quot; +</span>
<span class="nc" id="L121">                        &quot;this week&quot;,</span>
<span class="nc" id="L122">                    style = MaterialTheme.typography.labelMedium</span>
                )
<span class="nc bnc" id="L124" title="All 4 branches missed.">            } else if (completedAmount != null &amp;&amp; completedAmount &gt; 0) {</span>
<span class="nc" id="L125">                Text(</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">                    &quot;completed ${exercise.stats?.amountCompleted} sets total, none this week&quot;,</span>
<span class="nc" id="L127">                    style = MaterialTheme.typography.labelMedium</span>
                )
<span class="nc" id="L129">            }</span>
<span class="nc" id="L130">        } else {</span>
<span class="nc" id="L131">            Text(&quot;No stats available.&quot;)</span>
<span class="nc" id="L132">        }</span>
<span class="nc" id="L133">    }</span>
<span class="nc" id="L134">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>